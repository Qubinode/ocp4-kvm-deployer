- set_fact:
    stdout_lines: []

- name: Test if api-int OpenShift Entries Exist
  command: "dig +short @{{ idm_server_ip }} api-int.{{ cluster_name }}.{{ idm_dns_forward_zone }}"
  register: validate_entry

- set_fact:
    stdout_lines: "{{ stdout_lines + validate_entry.stdout_lines }}"

- name: Test if api OpenShift Entries Exist
  command: "dig +short @{{ idm_server_ip }} api.{{ cluster_name }}.{{ idm_dns_forward_zone }}"
  register: validate_entry

- set_fact:
    stdout_lines: "{{ stdout_lines + validate_entry.stdout_lines }}"

- name: Test if application endpoint for OpenShift  Exist
  command: "dig +short @{{ idm_server_ip }} test.apps.{{ cluster_name }}.{{ idm_dns_forward_zone }}"
  register: validate_entry

- set_fact:
    stdout_lines: "{{ stdout_lines + validate_entry.stdout_lines }}"

- name: Test if OpenShift ctrlplane node Entries Exist
  command: "dig +short @{{ idm_server_ip }} ctrlplane-{{ item }}.{{ cluster_name }}.{{ idm_dns_forward_zone }}"
  register: validate_entry
  with_sequence: start=0 end="{{ ctrlplane_count|int - 1 }}" stride=1

- debug:
    var: validate_entry
    verbosity: 2

- set_fact:
    stdout_lines: "{{ stdout_lines + item.stdout_lines }}"
  with_items: "{{ validate_entry.results }}"

- debug:
    msg: "compute_count={{ compute_count }}"
  when: compute_count|int != 0

- name: Test compute node dns entries
  block:
    - name: Test if OpenShift compute nodes Entries Exist
      command: "dig +short @{{ idm_server_ip }} compute-{{ item }}.{{ cluster_name }}.{{ idm_dns_forward_zone }}"
      register: validate_entry
      with_sequence: start=0 end="{{ compute_node_count|int - 1 }}" stride=1

    - debug:
        var: validate_entry
        verbosity: 2
    
    - set_fact:
        stdout_lines: "{{ stdout_lines + item.stdout_lines }}"
      with_items: "{{ validate_entry.results }}"
  when: compute_count|int > 0

